pipeline {
    agent any

    tools {
            // Install the Maven version configured as "M3" and add it to the path.
            maven "maven3.6"
            jdk "jdk1.8"
        }
    triggers{cron('00 23 * * *')}
    stages {
        stage('checkout') {
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: '111', url: 'https://github.com/LeechenLove/javaapp.git']]])
            }
        }
        stage('mvn package') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('deploy war') {
            steps{
                script{
                withEnv(['JENKINS_NODE_COOKIE=background_job']) {
                     sh 'chmod +x ./scripts/killapp.sh'
                     sh './scripts/killapp.sh'
                }
                }
            }
        }
    }
     post{
        always {
            sh 'echo always'
        }
        success {
            sh "echo success"
        }
        failure {
            sh "echo fail"
        }
      }
}